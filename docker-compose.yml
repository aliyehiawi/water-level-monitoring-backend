services:
  mosquitto:
    image: eclipse-mosquitto:2.0
    ports:
      - "1883:1883"
    volumes:
      - ./docker/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf:ro
      - mosquitto_data:/mosquitto/data

  backend:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SERVER_PORT: "8080"
      SERVER_CONTEXT_PATH: /api
      HIBERNATE_DDL_AUTO: create-drop
      JWT_SECRET: 7f0f4e9b2a1d4c3e8b7a6d5c4b3a2f1e0d9c8b7a6f5e4d3c2b1a0f9e8d7c6b5a
      MQTT_BROKER_URL: tcp://mosquitto:1883
      MQTT_CLIENT_ID: water-level-backend-compose

      CORS_ALLOWED_ORIGINS: http://localhost:3000,http://localhost:4200
      WEBSOCKET_ALLOWED_ORIGINS: http://localhost:3000,http://localhost:4200
    depends_on:
      mosquitto:
        condition: service_started

volumes:
  mosquitto_data:
